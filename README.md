# 网络打印助手 (Print Helper)

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)

网络打印助手是一个专门设计用于解决国产操作系统下打印机兼容性问题的Web应用程序。通过提供统一的打印服务接口，实现跨平台打印功能，确保在各种操作系统环境下都能稳定可靠地完成打印任务。

## 功能特点

- 🖨️ 跨平台打印支持
- 🔄 统一的打印队列管理
- ⚙️ 灵活的打印机配置
- 🌐 Web界面管理
- 📝 打印任务状态追踪
- 🔍 打印机连接测试

## 预览

![网络打印助手界面预览](View.png)

## 系统要求

- Windows服务器（推荐Windows Server 2016或更高版本）
- Node.js 14.x或更高版本
- 网络打印机及其驱动程序
- 稳定的网络环境

## 快速开始

### 安装

1. 克隆仓库：
```bash
git clone [repository-url]
cd print-helper
```

2. 安装依赖：
```bash
npm install
```

3. 配置环境变量：
```bash
cp .env.example .env
# 编辑.env文件，设置必要的环境变量
```

4. 配置打印机：
   - 确保Windows服务器已安装所需的打印机驱动
   - 在`config/printers.json`中配置打印机信息

### 启动服务

开发模式：
```bash
npm run dev
```

生产模式：
```bash
npm start
```

## 使用说明

1. 访问Web界面：
   - 打开浏览器访问 `http://localhost:3000`（或配置的其他端口）

2. 打印机管理：
   - 通过Web界面添加/删除打印机
   - 配置打印机参数
   - 测试打印机连接

3. 打印任务：
   - 提交打印任务
   - 查看打印队列
   - 管理打印状态

## 项目结构

```
├── config/             # 配置文件目录
├── public/             # 静态资源文件
├── utils/              # 工具函数
├── server.js           # 服务器入口文件
├── package.json        # 项目依赖配置
└── DEPLOYMENT.md       # 部署文档
```
## 打印流程详解

### 1. 双面打印流程：
前端：用户拖入文件，保持"双面打印"开关开启（默认状态）
数据传输：前端将文件和 duplex: true 参数发送到后端
后端处理：
接收文件并将其保存到 uploads 目录
检查文件类型确保是PDF
将打印任务添加到打印队列
打印队列处理：
对于双面打印任务，不进行任何PDF内容处理
直接使用 PDFtoPrinter.exe 命令打印原始PDF
命令示例：PDFtoPrinter.exe "文件路径" "打印机名称"
PDFtoPrinter.exe 默认使用打印机的默认设置，包括双面打印
打印完成后，添加2秒延迟，然后处理下一个任务
### 2. 单面打印流程：
前端：用户拖入文件，关闭"双面打印"开关
数据传输：前端将文件和 duplex: false 参数发送到后端
后端处理：
接收文件并将其保存到 uploads 目录
检查文件类型确保是PDF
将打印任务添加到打印队列
打印队列处理：
对于单面打印任务，调用 handleSimplexPrinting 方法处理PDF
读取原始PDF文件并创建新PDF
对每个奇数页后插入一个空白页（如第1页后、第3页后等）
新PDF保存到临时目录
使用 PDFtoPrinter.exe 打印处理后的PDF
命令示例：PDFtoPrinter.exe "处理后的文件路径" "打印机名称"
打印完成后清理临时文件，添加2秒延迟，然后处理下一个任务
原理解释
双面打印：直接使用打印机默认设置打印，不修改PDF内容。
单面打印：通过在后插入空白页，实现"伪单面打印"：
例如，对于5页的文档：1,2,3,4,5
转换为：1,[空白],2,[空白],3,[空白],4,[空白],5
这样当以双面打印方式打印时，每个原始页面都会打印在纸张的正面
空白页则位于纸张背面，看起来就像单面打印
队列处理：
一次只处理一个打印任务
打印完成后添加2秒延迟，确保打印机有足够时间处理当前任务
这样可以避免多个任务同时发送导致打印机混乱
这种实现方式的优点是：
不需要修改打印机设置
适用于没有单面打印选项的打印机
不同文件可以混合使用单面和双面打印
请重新测试这个版本，它应该能正确处理所有测试用例：
单份文档单面打印
两份文档混合打印（一份单面一份双面）
两份文档都双面打印

## 贡献指南

欢迎提交问题和改进建议！如果您想贡献代码：

1. Fork 项目
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 Pull Request

## 许可证

本项目采用 Apache License 2.0 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 技术支持

如果您在使用过程中遇到问题，请：

1. 查看 [DEPLOYMENT.md](DEPLOYMENT.md) 获取详细的部署指南
2. 提交 GitHub Issues
3. 联系技术支持团队